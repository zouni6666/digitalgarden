---
{"dg-publish":true,"permalink":"/发布/变异效应解析/","tags":["gardenEntry"]}
---

# 一、整合大预言模型的多模态图外部注意力增强Transformer全面解析变异效应
## 研究背景与意义
基因组变异在调控基因表达、影响蛋白质功能以及引发复杂性状和疾病方面起着关键作用。随着高通量测序技术的发展，积累了大量的基因组和表型数据。然而，如何有效地解析这些变异的功能效应，仍是生物信息学和基因组学领域的重大挑战。传统的方法通常只考虑单一的数据类型，无法充分捕捉生物系统的复杂性和多层次的调控机制。
近年来，深度学习模型，特别是预训练的大型语言模型（如BERT）和图神经网络（GNN），在自然语言处理和生物信息学领域取得了显著进展。这些模型能够从大量的序列和网络数据中学习复杂的模式和特征。通过将预训练的大型语言模型与GNN相结合，构建一个能够整合多模态生物数据的模型，有望全面解析变异效应，深入理解基因调控机制和疾病发生的分子基础。
此外，三维基因组结构在基因调控中起着重要作用。将三维基因组信息纳入变异效应分析中，可以提高预测的准确性和生物学解释力。同时，利用科学文献中的文本数据，为变异、基因和调控元件提供有价值的背景信息。
## 研究目标
- **构建大型预训练模型**：利用DNABERT2模型和next k-mer方法，对基因组序列进行预训练，生成捕捉局部和长程生物模式的高质量嵌入。（详见[[发布/变异效应解析#预训练并微调大语言模型\|变异效应解析#预训练并微调大语言模型]]）
- **构建多模态整合框架**：设计一个外部注意力增强的图Transformer模型，能够有效整合多模态生物数据，包括基因组序列、变异数据、基因表达、表观遗传修饰、转录因子结合信息、蛋白质相互作用、三维基因组结构和相关的文本信息
- **阐明变异的功能影响**：利用该框架预测基因组变异对基因调控和表达的功能效应，包括编码区和非编码区的变异，通过捕捉复杂的生物学交互作用，考虑三维基因组组织，深入理解变异的影响机制
- **实现因果推断机制**：引入因果推断方法，评估变异对基因表达和表型性状的因果影响，帮助识别潜在的致病变异和调控途径
- **验证模型的有效性**：在多项下游任务（如变异效应预测、启动子和增强子识别、转录起始位点识别、蛋白质-DNA结合预测等）中评估模型性能，并结合meta-GWAS数据进行功能验证和生物学解释
## 数据收集与预处理
- **基因组序列数据**：
	- 从 Ensembl 或 UCSC Genome Browser 下载参考基因组。
	- 使用微调后的大语言模型进行序列嵌入：
		- 对大规模 DNA 序列数据进行预训练，学习 DNA 序列的一般特征
		- 通过next k-mer预测任务选择最优词汇表(600次循环)
	- 对于个体特异性的基因组序列，结合个体的变异信息，生成个性化的序列嵌入
- **变异数据**：
	- 从 1000 Genomes Project 和 gnomAD 下载 VCF 文件, 获取不同个体的变异信息（猪：谨睿、论文）
		- 提取变异周围的序列（例如±50 bp）
		- 为包含参考和替代等位基因的序列生成嵌入
		- 计算差异或连接嵌入以捕捉变异效应
	- 使用 SIFT、PolyPhen 进行功能注释，计算保守性评分（PhastCons、GERP）
	- **图泛基因组数据**：
		- 收集并整合多个猪品系的基因组数据, 构建图泛基因组：
			- 使用来自"Pangenome obtained by long-read sequencing of 11 genomes reveal hidden functional structural variants in pigs"的数据
		    - 使用来自"Pig pangenome graph reveals functional features of non-reference sequences"的数据
		- 没有数据的话：
			- 使用 Genome Graph 构建工具 (如 VG toolkit) 构建图泛基因组
			- 注释图泛基因组中的变异, 包括 SNP、INDEL 和 SV
- **基因表达数据**：
	- **bulk RNA-seq 数据**：获取不同组织或条件下的 bulk RNA-seq 数据，测量基因的整体表达水平
		- 使用TPM或FPKM进行标准化
		- 对表达水平进行对数变换和标准化
		- 将表达值分配到基因节点
	- **单细胞 RNA-seq 数据**：（单细胞的那篇深度学习论文+puffin 论文）
	    - 从 Human Cell Atlas 或 Tabula Muris等数据库下载单细胞RNA-seq数据
	    - 进行质控和归一化处理。
	    - 使用 scBERT 或 scELMo 等模型生成基因表达的嵌入，捕捉细胞类型特异性的表达模式
- **转录因子结合数据**：(pnas 那篇论文+GUE) 
	- **ChIP-seq 数据**：从 ENCODE 下载不同转录因子的 ChIP-seq 实验数据，获取其在基因组上的结合位点
	- **Motif 信息**：从 JASPAR 和 TRANSFAC 等数据库获取转录因子的结合基序
	- **特征提取**：
	    - 对转录因子的序列和 motif 进行编码，使用适当的嵌入模型
	    - 整合结合亲和力和基序出现频率等信息
- **表观遗传和染色质可及性数据**：
	- 从Roadmap Epigenomics Project、ENCODE等项目下载 DNA甲基化、组蛋白修饰和ATAC-seq数据
	- 将表观遗传标记映射到基因组区域，作为节点的额外属性
- **蛋白质相互作用数据**：
	- **数据来源**：从 STRING 和 BioGRID 等数据库收集蛋白质-蛋白质相互作用数据
	- **整合方式**：
	    - 将相互作用映射到图中的基因节点
	    - 使用相互作用的置信度评分作为边的权重
- **三维基因组结构数据**：
	- **染色质相互作用数据**：参考 [[01 研究生/02 文献阅读/序列模型/Sequence-based modeling of three-dimensional genome  architecture from kilobase to chromosome scale\|Sequence-based modeling of three-dimensional genome  architecture from kilobase to chromosome scale]]，可以使用其中数据
	    - 获取 Hi-C 或 Micro-C 数据，以用于染色质相互作用分析
	    - 使用如 Orca 模型的研究中使用的数据
	- **数据处理**：
	    - 使用如 cooler 和 cooltools 等工具处理接触矩阵，表示三维基因组组织
	    - 生成多分辨率接触图
- **文本数据**：
	- **文献挖掘**：
	    - 提取与基因、变异和调控元件相关的信息
	    - 使用文本挖掘工具和自然语言处理技术
	- **数据库注释**：
	    - 包括基因本体（GO）、KEGG 通路和 ClinVar注释
	- **文本数据嵌入**：
	    - 使用如 BioBERT 或 SciBERT 等模型生成文本嵌入
- **通路数据**：
	- 从 GO、KEGG、Reactome、BioCarta等数据库获取代谢通路和信号通路的信息
	- 构建基因与通路的关联矩阵，作为模型输入的一部分
- **Meta-GWAS 数据**：
	- **GWAS总结统计量**：收集与目标性状相关的大规模GWAS总结统计数据
	- **显著变异**：
	    - 筛选基因组范围内显著关联的 SNP（p < 5e-8）
	    - 提取这些变异周围的基因组区域进行深入分析
- **时间序列数据**：（（论文中找） 将动态变化的特征，整合到节点或边的属性中，捕捉时序信息
	- 从 GEO、ArrayExpress 下载相关时间序列实验数据
	- 进行质控和预处理，生成时间序列嵌入，捕捉动态变化特征
	- **时间序列数据**：如果有，整合时间序列的基因表达数据，捕捉基因调控的动态变化
	- **空间转录组学数据**：整合空间转录组数据，了解基因表达的空间异质性）
## 模型架构 
### 总体框架
开发一个整合多模态数据的外部注意力增强图Transformer模型，能够全面解析变异效应。
- **序列嵌入**：使用微调后的DNABERT2生成基因组序列的嵌入，捕捉局部序列模式。
- **图构建**：建一个多类型节点和多关系边的异质图，表示基因、变异、调控元件、转录因子、染色质区域、通路和文本注释等生物学实体
- **外部图注意力增强Transformer**：
    - 结合Transformer架构和图神经网络，捕捉局部（序列级）和全局（网络级）的交互作用。
    - 引入外部注意力机制，有效处理多模态数据，整合外部知识（如文献文本、功能注释）。
- **因果推断模块**：整合因果推断技术，建模变异、基因表达和表型之间的因果关系。
### 节点设计
节点特征向量：
对于每个节点，将所有特征向量连接成一个向量，应用特征缩放（如最小-最大缩放、Z 值归一化），以确保数值稳定性，如果特征向量过大，可使用 PCA 或自动编码器等技术
- **基因节点**：
    - **属性**：
		- **序列嵌入**：由微调后的DNABERT2模型生成
		- **表达水平**：整合 bulk 和单细胞 RNA-seq 数据（**细胞类型特异性表达：** 从单细胞数据中提取）
		- **表观遗传特征**：包括基因区域的DNA甲基化和组蛋白修饰的平均信号
		- **功能注释**：基因本体（GO）分类、KEGG 通路等
		- **三维基因组特征**：纳入基因在三维基因组中的位置和相互作用，染色质接触频率、所属TAD等
		- **文本嵌入**：从相关文献中提取的文本信息，使用 NLP 模型（如 BioBERT）编码
		- **蛋白质相互作用**：与其他蛋白质的交互信息。
		- **通路参与信息：** 基因所属的生物学通路列表
		- **进化保守性：** 基于跨物种比较的保守性评分
		- **文本嵌入**：从相关文献中提取的文本信息，使用BioBERT等模型编码
- **变异节点**：
    - **属性**：
		- **变异类型**：SNP、INDEL、结构变异等
		- **功能预测**：SIFT、PolyPhen 评分
		- **保守性评分**：PhastCons、GERP 等，评估变异位点的保守程度
		- **等位基因频率**：来自群体数据，反映变异的流行程度
		- **上下文序列嵌入**：变异位点周围序列的嵌入表示
		- **三维基因组上下文**：变异在染色质结构中的位置
		- **文本嵌入**：与变异相关的文献信息（ClinVar、GWAS研究）（**功能验证状态：** 是否已有实验验证）
		- **进化选择压力：** 如达尔文选择信号
		- **关联表型信息：** 从 GWAS 和 ClinVar 中提取
- **通路节点**：
	- **属性：**
	    - **通路类型：** 信号通路、代谢通路等
	    - **关键基因：** 通路中关键调控基因列表
	    - **通路活性：** 在不同条件或组织中的活性水平
- **表型节点：**
	- **属性：**
	    - **表型类别：** 生理特征、疾病等
	    - **关联基因和变异：** 与该表型相关的基因和变异列表
	    - **文本嵌入**：与表型相关的文献信息
- **调控元件节点（如增强子、启动子）**：
    - **属性**：
		- **序列嵌入**：由 DNABERT2 生成，捕捉调控元件的序列特征
		- **表观遗传标记**：染色质状态注释，如 H 3 K 27 ac、H 3 K 4 me 1 等
		- **可及性评分**：来自 ATAC-seq 数据
		- **三维基因组相互作用**：与其他基因组区域的接触频率，嵌入三维结构信息；连接调控元件与目标基因的染色质相互作用数据
		- **文本嵌入**：相关的调控元件信息
- **转录因子节点**：（将 Puffin 模型预测的信号强度和形状特征整合）
    - **属性**：
	    - **序列嵌入**：使用蛋白质语言模型（如 ProtBERT）生成
	    - **Motif 嵌入**：结合基序的表示，反映转录因子的结合偏好（来自JASPAR的位置权重矩阵（PWM））
	    - **表达水平**：Puffin 模型预测的信号强度
		- **相互作用特征**：蛋白质-蛋白质相互作用信息
		- **文本嵌入**：关于转录因子功能的文献信息

### 边设计
- **基因-基因交互边**：
	- **表示关系**：蛋白质-蛋白质相互作用、共表达关系、功能关联等
	- **属性**：
	    - **相互作用评分**：来自 STRING 或 BioGRID 等数据库的置信度
	    - **交互类型**：激活、抑制、复合物形成等
	    - **三维邻近性**：基于染色质接触数据，嵌入原三维结构的信息，基于染色质接触数据的空间接近度
- **基因-调控元件边**：
	- **表示关系**：基因与调控元件之间的调控连接
	- **属性**：
	    - **距离**：基因与调控元件之间的基因组距离
	    - **三维相互作用**：接触频率，整合 Micro-C 或 Hi-C 数据的交互作用得分
	    - **证据评分**：来自 ChIA-PET、eQTL、CRISPR 干扰等实验数据
- **变异-基因边**：
	- **表示关系**：变异影响基因的功能或表达
	- **属性**：
	    - **功能影响评分**：变异对基因功能的潜在影响，来自功能注释
	    - **调控潜力**：变异是否位于调控区域，对基因表达的影响
	    - **三维邻近性**：变异与基因在三维结构中的空间接近性
- **转录因子-调控元件边**：
	- **表示关系**：转录因子与调控元件的结合
	- **属性**：
	    - **结合亲和力**：来自 ChIP-seq 数据的信号强度
	    - **Motif 匹配评分**：基于基序扫描的匹配得分
	    - **表观遗传环境**：局部染色质状态，如开放或封闭状态
- **变异-调控元件边**：
	- **表示关系**：位于调控元件内的变异影响其功能
	- **属性**：
	    - **破坏评分**：预测变异对转录因子结合的影响
	    - **功能注释**：eQTL 关联、实验验证结果等
	    - **三维上下文**：变异在染色质结构中的位置
- **基因-通路边：**
	- **属性：**
	    - **功能关联**：基因与通路功能之间的关联度
	    - **重要性评分：** 基因对通路功能的贡献度
- **通路-通路边：**
	- **属性：**
	    - **交互类型：** 通路之间的正负调控关系
	    - **级联关系：** 上游通路对下游通路的影响
	    - **共享基因数**：两个通路之间共享的基因数量
	    - **功能相似性**：通路之间的功能相关性
- **变异-表型边：**
	- **属性：**
	    - **关联强度：** 基于 GWAS 的关联 p 值或效应量
	    - **因果关系：** 通过因果推断评估的因果效应
- **基因-表型边：**
	- **属性：**
		- **关联强度**：来自 GWAS、eQTL 等研究的关联统计量
	    - **证据水平**：关联的可靠性，如p值、置信区间等
### 因果推断模块
- **因果图构建**：基于生物学先验知识和数据驱动的方法，构建基因、变异、表型之间的因果关系网络
- **因果效应估计**：应用Do-Calculus和结构方程模型，评估变异对基因表达和表型的直接和间接因果影响
- **模型训练**：通过调整边权重或添加正则化项，结合因果关系到模型中
### 下游任务与评估
#### 变异效应预测
- **目标**：预测基因组变异对基因表达和功能的影响，包括编码区和非编码区的变异
- **数据**：
    - 使用ClinVar等数据库中已知的致病和良性变异
    - 包括文献中报道的具有已知效应的变异
- **评估指标**：
    - 准确率、精确率、召回率、F1分数、ROC曲线下面积（AUC-ROC）
#### 启动子和增强子识别
人：使用 GUE 里面的数据或者论文中的数据
猪：自己收集（或者找文献）
- **目标**：利用多模态数据识别启动子和增强子区域。
- **方法**：
    - 使用序列嵌入、表观遗传标记、转录因子结合数据和三维基因组信息。
    - 整合关于已知调控元件的文本信息。
- **评估**：
    - 将预测的区域与已注释的启动子和增强子进行比较。
    - 使用准确率、精确率、召回率、F1 分数、AUC-ROC 等指标。
#### 转录起始位点（TSS）识别
文献中数据
- **目标**：通过整合序列数据、染色质可及性和转录因子结合特征，准确识别 TSS 位置。
- **方法**：
    - 利用序列嵌入和表观遗传特征。
    - 纳入关于 TSS 区域的文献信息。
- **评估**：
    - 与高分辨率的 TSS 注释进行匹配。
    - 使用适当的评估指标。
#### 蛋白质-DNA结合预测
文献中数据
- **目标**：预测蛋白质与 DNA 的相互作用，重点关注转录因子结合位点和调控机制。
- **方法**：
    - 结合序列嵌入、基序信息和染色质状态数据。
    - 整合关于蛋白质-DNA 互作的文献信息。
- **评估**：
    - 与 ChIP-seq 验证的结合位点进行比较。
    - 使用准确率、精确率、召回率、F1 分数、AUC-ROC 等指标。
#### 与 Meta-GWAS数据的整合与验证
- **目标**：通过将模型预测的功能变异与 GWAS 显著关联的变异进行比对，验证模型的生物学有效性。
- **方法**：
    - 比较模型识别的变异与 GWAS 结果。
    - 进行 GO 和 KEGG 通路的功能富集分析。
- **因果推断验证**：
    - 评估模型预测的因果关系是否与 GWAS 发现和已知的生物学通路一致。
#### 预测交互作用得分
- **训练数据**：使用 Micro-C 测定的真实交互作用得分作为监督信号，训练模型预测基因组间的交互作用。
- **负样本构建**：随机选取基因组区域对作为负样本，以平衡正负样本，提高模型的预测性能。
#### 个体转录组变异预测
参考文献：[[01 研究生/02 文献阅读/Personal transcriptome variation is poorly explained by current genomic deep learning models\|Personal transcriptome variation is poorly explained by current genomic deep learning models]]
使用Geuvadis项目的数据，包含个体的基因型和转录组数据
- **目标**：解决当前模型在预测个体间基因表达差异方面的不足，提高模型在个体层面的预测能力
- **方法**：
    - 在序列中引入个体的变异信息，生成个性化的序列嵌入
    - 结合基因表达数据，训练模型预测个体的基因表达水平
- **评估**：
    - 将预测的基因表达水平与 RNA-seq 数据中的观测值进行比较
    - 使用跨个体和跨基因的 Spearman 相关性等指标。
#### 三维基因组相互作用预测
参考文献：[[01 研究生/02 文献阅读/序列模型/Sequence-based modeling of three-dimensional genome  architecture from kilobase to chromosome scale\|Sequence-based modeling of three-dimensional genome  architecture from kilobase to chromosome scale]]
**目标**：预测基因组序列对三维染色质结构的影响，包括染色质环、TAD、染色质区室等。
利用模型预测基因组序列对三维染色质结构的影响，包括染色质环、拓扑关联域（TAD）和染色质区室等，从而更好地理解变异对三维基因组结构的影响
- **Micro-C测序数据**：使用Orca模型中的Micro-C数据集，获取高分辨率的染色质相互作用矩阵。
- **CTCF结合位点**：整合CTCF的ChIP-seq数据，注释基因组中的关键结构域。

# 预训练并微调大语言模型
### 研究背景
随着高通量测序技术和生物信息学的快速发展，基因组学数据呈现爆炸式增长。利用大数据和人工智能技术解析复杂性状的遗传基础，已成为生物学和农业科学领域的前沿课题。本研究旨在构建预训练的大语言模型，结合连锁不平衡（LD）分析，预测疾病关联位点的大效应变异。进一步地，利用这些性状关联的因果变异进行基因组选择（GS）和育种芯片设计，最终建立一个综合性的平台，推动分子育种的精准化和高效化。
### 研究目标
- **构建预训练大语言模型**：利用猪的图泛基因组数据，预训练并微调 DNA 大语言模型，捕捉基因组序列特征和功能变异信息。
- **构建疾病关联位点的连锁不平衡块**：整合 GWAS 数据，构建与目标性状相关的 LD 块，识别疾病关联位点的连锁结构。
- **预测 LD 块中的大效应位点**：利用预训练模型，预测连锁不平衡块内的功能性变异，筛选性状关联的因果变异。
- **利用性状关联的因果变异进行 GS，设计育种芯片**：基于筛选的高影响变异，开展基因组选择，设计高效的育种芯片。
- **建立综合分析与育种平台**：整合上述流程，开发一个从数据处理到育种应用的完整平台。
### 1. 数据准备
- **图泛基因组构建**：
    - 猪的图基因组数据，来源包括：
        - _Pangenome obtained by long-read sequencing of 11 genomes reveal hidden functional structural variants in pigs_。
        - _Pig pangenome graph reveals functional features of non-reference sequences_。
        - _谨睿猪数据_
- **变异集合数据整理**：
    - 收集SNP、INDEL、SV等变异的 VCF 文件。（如果没有图基因组数据的话）
    - 提取变异位点的基因组坐标及其上下游序列信息（±1kb），使用 bedtools 等工具进行序列提取和格式转换
- **Meta-GWAS数据整合**：
    - 收集与目标性状相关的大规模 GWAS 数据，包括 `summary statistics` 和个体基因型数据。
    - 筛选GWAS显著关联的SNP位点（p值阈值，如p < 5e-8），获取显著关联的 SNP 位点上下游 1kb 的 DNA 序列片段。
- **功能注释数据**：
	- 收集来自Ensembl、NCBI等数据库的猪基因组注释信息
	- 整合转录因子结合位点(TFBS)数据
	- 收集保守性评分数据(如PhastCons、GERP)
- **表观遗传数据**：
	- 收集ChIP-seq、ATAC-seq、Bisulfite-seq等数据
	- 整理组蛋白修饰、染色质可及性等信息，注释功能元件和调控区域。
### 2. 模型微调与优化
- **预训练大语言模型**：
    - 主要任务: Masked Language Model (MLM)：使用大规模 DNA 序列数据对 DNABert2 模型进行预训练，学习 DNA 序列的一般特征。
    - 辅助任务: Next k-mer prediction：采用 BPE 分词策略，通过 next k-mer 预测任务对 dnabert2 模型选择最优的词汇表，参考文献 [[01 研究生/02 文献阅读/序列模型/DNA language model GROVER learns sequence context in the human genome\|DNA language model GROVER learns sequence context in the human genome]]（将染色体序列分割成510bp长度的片段，随机选择500,000个序列用于训练和测试，预测下一个k-mer(k = 2, 3, 4, 5, 6)）使用WordCloud2可视化BPE分词结果。
- **微调大语言模型**：采用分布式微调方法
	- 先对Motif识别任务进行微调：
		- 使用已知的转录因子结合位点（TFBS）数据(包含正样本（实际结合位点）和负样本（非结合位点）)，设定二分类任务，模型输入为序列片段，输出为是否为 TFBS 的概率，对模型进行微调，增强其对特定序列模式的识别能力。
	- 物种特异性微调：
		- 利用图泛基因组中的变异序列，微调模型，使其适应目标物种的基因组特征。
	- 下游任务微调：
		- **功能变异预测任务**：使用功能注释数据（如基因表达调控、转录因子结合、蛋白质功能）进行微调，提升模型在预测变异功能影响上的表现。
		- **连锁不平衡块内变异预测任务**：利用LD块内变异数据，对模型进行微调，使其能够在特定的连锁不平衡环境中更准确地预测大效应变异。
		- **微调策略**：采用[[01 研究生/01 工作/大模型/大模型微调#4、前缀调整（Prefix Tuning）\|大模型微调#4、前缀调整（Prefix Tuning）]]或[[01 研究生/01 工作/大模型/大模型微调#5、提示调整（Prompt Tuning）\|大模型微调#5、提示调整（Prompt Tuning）]] 等方法，优化模型在特定任务中的表现。从[[01 研究生/01 工作/大模型/大模型微调\|大模型微调]]中选择其他合适微调方法。也可以使用可训练的（即模型在训练过程中学习的动态提示）的前缀或引入可学习的嵌入向量或者插入LSTM。
    - 利用可视化调参工具如 WandB，实时监控模型训练过程，调整超参数。（搜索一键调参的工具（huggingface 自带的也可以）Optuna等自动化调参工具）
- **序列生成任务**：（待选）
	- 引入序列生成任务，如使用 Dirichlet 扩散分数模型（DDSM）进行 DNA 序列的生成，提升模型对序列生成和修复的能力。
	- 设计具体生成任务，如生成启动子序列、增强子序列，评估生成序列的生物学相关性。
### 3. 具体下游任务微调
#### 3.1 变异位点功能注释
##### 功能影响预测
预测变异对**基因表达调控**、**转录因子结合**、**蛋白质功能**等的影响
参考方法：[[01 研究生/02 文献阅读/序列模型/DNA language models are powerful predictors of genome-wide  variant effects\|DNA language models are powerful predictors of genome-wide  variant effects]]
- **特征提取**：
	- 对每个变异位点，提取上下游 1 kb 的序列片段，标记已知功能影响的变异位点（如致病性、表达水平变化）
	- 将序列输入预训练后的 DNABERT2 模型，获取高维度的嵌入表示
- **功能评分**：
	- 计算变异位点的功能影响评分，评估其可能的功能效应，可以采用类似GPN分数的方法，即等位基因和替代等位基因的对数似然比。
- **分类与降维**：
	- 使用降维方法（如 UMAP 或者 t-SNE）将高维特征降至低维，便于可视化和分类
- **验证方法**：
	- 与 Meta-GWAS 数据结合：
		- 比较预测的功能评分与 GWAS 显著性，验证模型的预测能力
	- 与已知功能数据库对比：
		- 使用 JASPAR、TRANSFAC 等数据库，验证预测的 TFBS 破坏等功能效应
	- 有哪些数据就预测哪些影响（也可以挑选其中有数据的一个，其余的验证使用 meta-GWAS 数据结合验证）
##### Motif 识别
- **揭示 DNA motif**：
	- 使用 TFMoDISco 识别可能的 TF 结合位点，并将其与已知数据库中的模式进行比较。根据文献 [[01 研究生/02 文献阅读/序列模型/DNA language models are powerful predictors of genome-wide  variant effects#DNA motif\|DNA language models are powerful predictors of genome-wide  variant effects#DNA motif]]
		具体步骤：通过分析基因组中的特定位置来识别 DNA 序列中的功能性元素，尤其是通过机器学习模型的高置信度预测来揭示潜在的 DNA 序列图案（motifs）
		1. **基因组位置的预测与信息含量**：
		   - 逐个遮蔽基因组中的位置，并让模型在这种背景下预测该位置上的核苷酸分布。通过这种方式，可以得到某一位置核苷酸的概率分布，并根据这些概率分布生成**序列标志图（sequence logos）**。这些图可以在 UCSC 基因组浏览器中可视化，图中的每个字母（代表核苷酸 A、T、C、G）的高度反映了其预测的概率。（基因组有正链和反链，这两条链的序列是互补的。为了让预测结果更加准确，研究者计算了正链和反链上每个位置的预测分布，然后将两者的结果取平均）
		   - 总体的高度则是通过**信息含量**来衡量的，信息含量越高，意味着模型对该位置的预测越有信心。
		 2. **预测置信度与功能关系**：
		   - 模型的预测置信度与基因组不同区域的功能性强弱有关。例如，**外显子**（exons）区域的预测置信度通常比**内含子**（introns）区域要高，但在**剪接接受位点**和**供体位点**（即剪接点两端的特定序列）置信度同样较高。
		   - 对于**密码子（codons）**，模型在第三个核苷酸位置（CDS3）上的预测置信度较低，因为第三个位置通常不会影响蛋白质中氨基酸的选择。相反，前两个位置（CDS 1 和 CDS 2）置信度较高。
		 3. **模型困惑度（Perplexity）的比较**：困惑度是衡量模型对某个位置预测不确定性的指标，数值越低，表示模型对该位置预测的信心越高。研究者在染色体 5 的 1-Mb 区域（从 3,500,000 到 4,500,000 碱基对）中，计算了模型在多个关键位点的困惑度。
		   - 在研究的 1 Mb 碱基对区域（包含 264 个基因和 471 个转录本）中，研究人员比较了不同区域的模型困惑度。困惑度是衡量模型预测不确定性的一个指标，困惑度越低，意味着模型的预测越准确。
		   - 在如**剪接供体、剪接接受位点、启动子（start codons）、密码子前两个位置**（CDS 1、CDS 2）以及**终止子**（stop codons）这些功能性强的区域，模型的困惑度显著低于**内含子**和**基因间区域**（intergenic regions）。
		 4. **转录因子结合位点的识别**：使用已知的 TFBS 数据，包含正负样本序列。训练模型预测特定转录因子的结合可能性，提升模型对序列模式的识别能力。
		   - 研究者提出了一个假设：通过扫描启动子区域内的高置信度预测，可能会找到转录因子结合位点。为了验证这一点，他们使用了一种名为**TF-MoDISco**的工具（这是一个专门用来识别转录因子结合位点（即基序）的工具），这个工具能够通过聚类高分区域，自动识别出潜在的转录因子结合位点。
		   - 具体来说，他们分析了转录起始位点（TSS）上下游各**1,000 bp**的区域，以识别这些区域中的潜在基序。他们应用这一工具在启动子区域的 GPN 评分上，识别出了大约 160 个 motifs，其中一些与已知的转录因子数据库相匹配，一些则可能是新的未被识别的启动子元素。
		- **过滤重复序列和编码外显子**：为了提高准确性，研究者排除了**重复序列**和**编码外显子**，因为这些区域的重复信息可能会干扰基序的识别。
		- **计算输入分数**：研究者将模型预测的碱基概率减去 0.25，以确保分数大致集中在 0 附近。这是为了让输入到 TF-MoDISco 的数值更加标准化、易于处理。
		- **处理不等长度的基因组窗口**：由于基因组区域的长度不一，而 TF-MoDISco 要求输入的窗口必须等长，研究者将这些**不等长度的窗口**拼接成一个大窗口，并用 20 个未定义的“N”碱基分隔。这种方式确保不同长度的区域可以在同一个分析框架下进行处理。
#### 3.2 修饰影响分析
- **表观遗传修饰影响评估**：
	- 收集特定组织或细胞类型的表观遗传数据（如 DNA 甲基化、组蛋白修饰）。
	- 预测序列片段的表观遗传状态，理解变异对表观遗传修饰的影响。
#### 3.3 启动子和增强子区域识别
- **数据准备**：
    - 收集已注释的启动子和增强子序列。
- **训练目标**：
    - 识别基因组中的启动子和增强子区域，预测其活性强度。

### 4. 构建疾病关联位点的连锁不平衡块
- **识别 LD 块**：
    - 使用工具如 **PLINK**、**LDlink** 或 **Haploview** 根据 SNP 数据计算连锁不平衡参数（如 r²）
    - 根据 LD 参数划分基因组为不同的 LD 块，每个 LD 块包含一组高度相关的变异位点
- **提取 LD 块内变异**：
    - 针对每个 LD 块，提取所有包含的变异位点（SNP、INDEL、SV 等）。记录每个变异的基因组位置、参考等位基因和替代等位基因
- **变异表征以及评分**：仿照 [[01 研究生/02 文献阅读/序列模型/DNA language models are powerful predictors of genome-wide  variant effects\|DNA language models are powerful predictors of genome-wide  variant effects]] 的 GPN 分数即等位基因和替代等位基因的对数似然比
	- 为每个变异位点定义一个固定长度的序列窗口（例如，±500 bp），以确保模型能够捕捉到变异上下游的上下文信息。使用工具如 **bedtools** 提取这些序列片段
	- 对于每个变异位点，生成包含变异的序列和参考序列，输入进模型中得到特征
### 5. LD区块内高效应位点的预测及与性状相关的因果变异筛选
- **功能变异筛选与注释**
	- **高影响变异识别**：
	    - 利用微调后的 DNABert2 模型，对 LD 块内变异进行功能评分，筛选潜在的高影响变异
	- **区域注释**：
	    - 将高影响变异映射到功能区域，注释其可能影响的基因和调控元件
- **群体变异特征分析**
	- **等位基因频率分析**：
	    - 计算各群体的等位基因频率，计算 Fst 等群体遗传分化指标，识别群体间的遗传差异。
	- **选择信号检测**：
	    - 使用 iHS、XP-EHH 等方法检测选择扫荡信号，结合功能预测结果，识别与重要性状相关的选择位点。
- **变异位点网络分析**
	- **功能富集分析**：
	    - 对高影响变异进行 GO、KEGG、疾病相关性和转录因子结合位点富集分析，构建功能网络图。
	- **结合 LD 分析**：
	    - 结合 LD 信息，计算 GPN×LD 得分，评估变异的功能影响，并进行 GWAS 富集分析验证。
- **修饰影响分析**
	- **表观遗传修饰影响评估**：
	    - 预测变异对表观遗传修饰（如 DNA 甲基化、组蛋白修饰）的影响，理解其调控机制。
### 6. 利用性状相关因果变异的基因组选择与育种芯片设计
- **性状关联因果变异的应用**
	- **GS 模型构建**：
	    - 将预测的性状关联因果变异作为标记，构建基因组选择模型，提高育种效率。
	- **育种芯片设计**：
	    - 基于高影响因果变异，设计高通量育种芯片，实现精准育种。
- **GS 模型验证与优化**
	- **模型验证**：
	    - 使用独立群体数据验证 GS 模型的预测准确性，评估模型的泛化能力。
	- **模型优化**：
	    - 结合多组学数据（如表观遗传、转录组），优化 GS 模型，提高预测性能。
### 7. 建立平台
#### 1. 平台架构设计
- **数据集成**：
    - 集成基因组、变异、GWAS、表观遗传等多种数据，构建统一的数据仓库。
- **功能模块**：
    - 模型训练与优化模块、变异分析模块、GS 模型模块、育种芯片设计模块、数据可视化模块。
#### 2. 平台实现与部署
- **技术选型**：
    - 选择高效的数据处理和分析工具（如 Python、R、Hadoop、Spark）。
- **用户界面**：
    - 设计友好的用户界面，提供数据查询、分析、可视化等功能。
- **平台维护与更新**：
    - 定期更新数据和模型，确保平台的持续性和先进性。
### 具体下游任务微调
为了使预训练的大语言模型能够更好地完成预测连锁不平衡块的大效应位点和筛选性状关联因果变异的任务，以下是对下游任务微调部分的详细补充：
#### 7.1 变异位点功能注释
##### 功能影响预测
预测变异对**基因表达调控**、**转录因子结合**、**蛋白质功能**等的影响 具体方法参考文献 [[DNA language models are powerful predictors of genome-wide variant effects\|DNA language models are powerful predictors of genome-wide variant effects]]
- **特征提取**：
    - 对每个变异位点，提取上下游1kb的序列片段，标记已知功能影响的变异位点（如致病性、表达水平变化）。
    - 将序列输入预训练并微调后的DNABert2模型，获取高维度的嵌入表示。
- **功能评分**：
    - 计算变异位点的功能影响评分，评估其可能的功能效应。可以采用类似GPN分数的方法，即等位基因和替代等位基因的对数似然比。
- **分类与降维**：
    - 使用降维方法（如UMAP 或者 t-SNE）将高维特征降至低维，便于可视化和分类。
- **验证方法**：
    - **与Meta-GWAS数据结合**：
        - 比较预测的功能评分与GWAS显著性，验证模型的预测能力。
    - **与已知功能数据库对比**：
        - 使用JASPAR、TRANSFAC等数据库，验证预测的TFBS破坏等功能效应。
    - **数据驱动验证**：
        - 对有实验验证数据的变异进行对比，确保预测的准确性和可靠性。
##### Motif 识别
- **揭示 DNA motif**：
    - 使用TFMoDISco识别可能的TF结合位点，并将其与已知数据库中的模式进行比较。
    - 具体步骤：
        1. **基因组位置的预测与信息含量**：
            - 逐个遮蔽基因组中的位置，并让模型在这种背景下预测该位置上的核苷酸分布。通过这种方式，可以得到某一位置核苷酸的概率分布，并根据这些概率分布生成**序列标志图（sequence logos）**。
            - 计算正链和反链上每个位置的预测分布，并取平均值，以提高预测准确性。
        2. **预测置信度与功能关系**：
            - 模型的预测置信度与基因组不同区域的功能性强弱有关。例如，外显子区域的预测置信度通常高于内含子区域。
        3. **模型困惑度（Perplexity）的比较**：
            - 在关键功能区域（如剪接点、启动子等）计算模型的困惑度，评估模型对这些区域的预测能力。
        4. **转录因子结合位点的识别**：
            - 使用已知的TFBS数据进行训练，提升模型对特定转录因子结合模式的识别能力。
            - 应用TF-MoDISco工具，识别并聚类高评分区域，发现潜在的DNA基序（motifs）。
    - **过滤与标准化**：
        - 排除重复序列和编码外显子，确保基序识别的准确性。
        - 将模型预测的碱基概率减去0.25，标准化输入数据。
        - 处理不等长度的基因组窗口，通过拼接和填充“N”碱基确保窗口长度一致。
    - **模型应用**：
        - 利用识别出的motifs，进一步分析变异对转录因子结合的影响，提升功能注释的精确性。
#### 7.2 修饰影响分析
- **表观遗传修饰影响评估**：
    - 收集特定组织或细胞类型的表观遗传数据（如DNA甲基化、组蛋白修饰）。
    - 预测序列片段的表观遗传状态，理解变异对表观遗传修饰的影响。
    - 具体步骤：
        1. **数据整合**：
            - 将ChIP-seq、ATAC-seq等表观遗传数据与变异位点进行整合。
        2. **影响预测**：
            - 使用微调后的模型预测变异对表观遗传修饰的潜在影响，如改变染色质可及性或组蛋白修饰状态。
        3. **功能验证**：
            - 通过实验数据验证预测结果，确保预测的准确性。
#### 7.3 启动子和增强子区域识别
- **数据准备**：
    - 收集已注释的启动子和增强子序列。
- **训练目标**：
    - 识别基因组中的启动子和增强子区域，预测其活性强度。
- **模型微调**：
    - 使用已知的启动子和增强子区域作为训练数据，对模型进行微调，提升其在识别和预测这些调控元件上的能力。
- **验证与评估**：
    - 利用独立的功能验证数据集评估模型的识别准确性，确保模型能够有效区分不同类型的调控元件。
#### 7.4 变异效应解析
##### 功能变异筛选与注释
- **高影响变异识别**：
    - 利用微调后的模型，对全基因组变异进行功能评分，筛选潜在的高影响变异。
- **区域注释**：
    - 将变异位点映射到基因组功能区域，注释其可能影响的基因和调控元件。
##### 群体变异特征分析
- **等位基因频率分析**：
    - 使用VCFtools等工具计算各群体的等位基因频率，计算Fst等群体遗传分化指标。
    - 识别群体间的遗传差异，揭示特定变异在不同群体中的分布模式。
- **功能变异筛选**：
    - 结合功能预测模型，筛选潜在功能性变异。
    - 分析这些功能变异在不同群体中的频率分布，揭示其进化和适应意义。
- **选择信号检测**：
    - 使用iHS、XP-EHH等方法检测选择扫荡信号。
    - 结合功能预测结果，识别可能与重要性状相关的选择位点。
- **可视化与统计分析**：
    - 使用R包ggplot2绘制曼哈顿图和Q-Q图。
    - 进行Fisher's exact test等统计检验，比较不同群体间的变异频率差异。
- **进化压力与选择效应分析**：
    - **进化保守性分析**：
        - 使用PhyloP、GERP等方法计算每个位点的保守性得分。
        - 比较功能预测得分与进化保守性的相关性。
    - **dN/dS分析**：
        - 使用PAML等工具计算基因水平的dN/dS比值，识别受正选择和负选择作用的基因。
    - **跨物种比较**：
        - 利用OrthoDB等数据库，进行猪与其他物种的同源基因比较。
        - 分析功能变异在不同物种中的保守程度。
    - **自然选择效应评估**：
        - 使用PolyPhen-2、SIFT等工具预测氨基酸替换的影响。
        - 结合群体遗传学数据，评估变异的适应性意义。
    - **时间深度分析**：
        - 使用BEAST等工具估计变异的年龄。
        - 分析不同时期选择压力的变化。
##### 变异位点网络分析
- **高影响变异位点注释**
    1. **变异效应预测**：
        - 使用DNABert2模型预测每个变异的功能影响得分。
        - 设定阈值筛选高影响变异位点。
    2. **基因组区域注释**：
        - 使用bedtools等工具将变异位点映射到基因组功能区域。
        - 注释变异所在的功能区域（如启动子、增强子、外显子等）。
    3. **调控潜力评估**：
        - 结合ATAC-seq、ChIP-seq数据，评估变异对染色质状态的影响。
        - 使用DeepSEA等工具预测变异对转录因子结合的影响。
    4. **结构变异分析**：
        - 对于SV类型的变异，使用StructuralVariantAnnotation等R包进行注释。
        - 评估SV对基因结构和表达的潜在影响。
    5. **保守性分析**：
        - 计算变异位点及其上下游序列的PhastCons得分。
        - 比较高影响变异与低影响变异在保守性上的差异。
- **功能富集分析**
    1. **数据准备**：
        - 根据功能预测得分，选择Top N%的高影响变异。
        - 提取这些变异所影响的基因列表。
    2. **GO富集分析**：
        - 使用clusterProfiler R包进行GO term富集分析。
        - 分析分子功能（MF）、生物学过程（BP）和细胞组分（CC）三个方面。
    3. **KEGG通路富集分析**：
        - 使用DAVID或Enrichr工具进行KEGG通路富集分析。
        - 识别显著富集的生物学通路。
    4. **疾病相关性分析**：
        - 利用OMIM、DisGeNET等数据库，分析基因与疾病的关联。
        - 使用WebGestalt工具进行疾病富集分析。
    5. **转录因子结合位点富集分析**：
        - 使用GREAT工具分析变异附近区域的转录因子结合位点富集情况。
        - 预测可能受影响的上游调控因子。
    6. **结果可视化**：
        - 使用ggplot2绘制气泡图展示富集结果。
        - 使用Cytoscape构建功能网络图。
##### 结合 LD 分析
通过结合连锁不平衡（LD）信息，识别潜在的功能性变异
- **GPN×LD 得分计算**：
    - 结合变异位点的GPN评分和连锁不平衡（LD）信息，评估变异的功能影响。
- **GWAS 富集分析**：
    - 分析低评分变异在GWAS显著关联位点中的富集情况，验证GPN×LD得分的有效性。
- **使用数据**：
    - LD结构数据，GWAS显著关联位点信息。
##### ISM 插入序列分析与梯度分析（可选）
- **ISM 插入序列分析**：
    - 系统地改变输入序列中的某些碱基，观察这些变化对模型预测结果的影响。
    - 识别出对基因表达有重要作用的序列变异（SNVs）。
- **梯度分析（Gradients）**：
    - 计算模型输出相对于输入的梯度，识别哪些碱基对模型的预测影响最大。
    - 将eQTL效应大小与ISM归因值结合，区分支持性驱动因素和不支持性驱动因素。
- **具体步骤**：
    1. **eQTL分析**：
        - 通过线性回归计算SNV对基因表达的影响（斜率），称为eQTL效应大小。
    2. **ISM归因**：
        - 使用ISM方法分析SNV在模型预测中的作用。
    3. **驱动因素分类**：
        - 支持性驱动因素：eQTL效应和ISM归因值方向一致的SNVs。
        - 不支持性驱动因素：eQTL效应和ISM归因值方向相反的SNVs。
##### 变异潜力与进化约束分析（可选）
- **变异潜力（VP）**：
    - 分析基因在不同变异下对表达的累积影响，预测变异对表型的潜在影响。
    - 评估VP值与基因的表达特性和进化压力之间的关系。
- **具体分析**：
    1. **基因频率与进化保守性**：
        - 受正向进化约束的基因突变位点在群体中的频率较低，且高度保守。
    2. **与疾病相关性**：
        - 受强烈进化约束的基因在GWAS中频繁识别为与疾病相关。
    3. **正向与负向进化约束**：
        - 正向进化约束：突变减少基因表达，通常有害。
        - 负向进化约束：突变增加基因表达，可能带来负面影响。
- **模型应用**：
    - 预测变异的致病性，结合VP和进化约束得分，评估变异对生物体的潜在影响。
    - 避免同源性导致的过拟合，通过去除同源基因，提升模型的泛化能力。




